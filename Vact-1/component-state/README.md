## 组件和内部状态：

在上一步中我们创建了实例，但还存在以下问题：
- 每次更改都会触发完整虚拟DOM树上的协调函数
- 状态是全局的
- 我们需要在状态改变后显式调用render函数

要解决以上问题就需要我们自定义的组件，用户要获得实时更新的能力和拥有内部状态就需要在我们的组件基础上进行开发，这也就是React.Component;
同时组件还能添加自定义的tag用于JSX解析，也包含生命周期的一些勾子函数等等。

### Step1:

创建一个可继承的Component Class。

## Step2:

我们创建了Component之后，那么我们在页面上使用的元素名自然就变成我们自定义的元素名了，比如`<Button>`，那么这个元素需要我们去修改createElement函数吗？不需要，预处理工具会将组件返回作为type，这时候我们就需要在处理type的时候根据type类型生成实例就行了。其中通过组件生成的实例通常render只会返回一个元素，所以只会保留childInstance属性，而dom元素对应实例则可能多个子元素所以使用的是childInstances。
至于为什么在组件公共实例中需要保留内部实例的引用，在组件更新时，我们需要调用reconcilie协调函数，需要更新的实例就是内部实例，所以需要在组件公共实例this中保留引用。

### Step3:

在组件内部状态更新时触发实例更新

### Step4:

最后一步就是在协调算法中处理组件类型的实例，因为组件就只有一个子元素，所以不需要去更新子实例，只需要更新公共实例的props属性，重新渲染子元素再通过协调函数更新子元素。

